name: Build RTweaked Engine

on: 
  push:
    branches: [ "main" ]
  workflow_dispatch: # Allows you to run this manually

jobs:
  build:
    runs-on: macos-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Download 88MB API Engine
        run: |
          # Downloads your libRobloxLib.dylib from the Release you made
          curl -L -o libRobloxLib.dylib https://github.com/adamjogkins-eng/RTweaked/releases/download/v1/libRobloxLib.dylib
          
      - name: Hunt for Symbols (The Secret Names)
        run: |
          echo "--- START SYMBOL HUNT ---"
          # This command lists all the function names inside the 88MB file
          # We search for 'execute' or 'lua' to find the right name for your menu
          nm -gU libRobloxLib.dylib | grep -Ei "exec|lua|run" || echo "No obvious symbols found"
          echo "--- END SYMBOL HUNT ---"

      - name: Compile RTweaked Menu
        run: |
          # We use xcrun to compile for iPhone (arm64)
          # -L. tells it to look in this folder for the API
          # -lRobloxLib links your code to the 88MB engine
          xcrun -sdk iphoneos clang++ -dynamiclib -arch arm64 \
          -fobjc-arc -O3 \
          -L. -lRobloxLib \
          iOSStrap.mm -o iOSStrap.dylib \
          -framework UIKit -framework Foundation -framework QuartzCore
          
      - name: Upload Finished Dylib
        uses: actions/upload-artifact@v4
        with:
          name: RTweaked-Compiled
          path: iOSStrap.dylib
